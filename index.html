<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>AI App & Web Builder PRO</title>
    <script src="[https://cdn.tailwindcss.com](https://cdn.tailwindcss.com)"></script>
    <style>
        /* Mobile View Fix (100dvh) */
        body { 
            min-height: 100dvh; 
            display: flex; 
            flex-direction: column; 
            overflow: hidden; 
            margin: 0;
            background-color: #09090b;
        }
        #workspace { flex: 1; position: relative; background: #18181b; }
        iframe { width: 100%; height: 100%; border: none; background: white; }
        .loading-spinner {
            border: 3px solid rgba(255,255,255,0.1);
            border-radius: 50%;
            border-top: 3px solid #3b82f6;
            width: 24px;
            height: 24px;
            animation: spin 1s linear infinite;
        }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
    </style>
</head>
<body class="text-zinc-100 font-sans">

    <div class="flex flex-1 overflow-hidden">
        <aside class="w-64 border-r border-zinc-800 flex flex-col bg-zinc-950 flex-shrink-0 hidden md:flex">
            <div class="p-4">
                <button onclick="newProject()" class="w-full bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 px-4 rounded-xl transition flex items-center justify-center gap-2 shadow-lg shadow-blue-900/20">
                    <span>+</span> New Project
                </button>
            </div>
            <div id="project-list" class="flex-1 overflow-y-auto px-2 space-y-1"></div>
            <div class="p-4 border-t border-zinc-800">
                <button onclick="toggleSettings(true)" class="flex items-center gap-2 text-zinc-400 hover:text-white transition w-full p-2 rounded-lg hover:bg-zinc-900">
                    ‚öôÔ∏è API Settings
                </button>
            </div>
        </aside>

        <main class="flex-1 flex flex-col relative overflow-hidden">
            <header class="h-14 border-b border-zinc-800 flex items-center justify-between px-4 bg-zinc-950/50 backdrop-blur-xl z-20">
                <div class="flex items-center gap-4">
                    <span class="font-bold text-blue-500 tracking-tighter text-lg">AI BUILDER</span>
                    <div class="flex gap-1">
                        <div class="w-2.5 h-2.5 rounded-full bg-red-500/50"></div>
                        <div class="w-2.5 h-2.5 rounded-full bg-yellow-500/50"></div>
                        <div class="w-2.5 h-2.5 rounded-full bg-green-500/50"></div>
                    </div>
                </div>

                <div class="flex items-center gap-2">
                    <div class="bg-zinc-900 p-1 rounded-xl flex border border-zinc-800">
                        <button id="btn-preview" onclick="setView('preview')" class="px-4 py-1.5 rounded-lg text-sm bg-blue-600 text-white shadow-lg transition">Preview</button>
                        <button id="btn-code" onclick="setView('code')" class="px-4 py-1.5 rounded-lg text-sm text-zinc-400 hover:text-white transition">Code</button>
                    </div>
                    <button onclick="downloadCode()" class="bg-white text-black px-4 py-1.5 rounded-lg text-sm font-bold hover:bg-zinc-200 transition">
                        Export
                    </button>
                </div>
            </header>

            <div id="workspace">
                <iframe id="preview-frame" name="preview" sandbox="allow-scripts allow-modals allow-forms"></iframe>
                <div id="code-view" class="hidden p-6 font-mono text-sm text-blue-300 bg-zinc-950 h-full overflow-auto">
                    <pre id="code-display" class="whitespace-pre-wrap break-all"></pre>
                </div>
            </div>

            <footer class="p-4 border-t border-zinc-800 bg-zinc-950/80 backdrop-blur-md">
                <div class="max-w-4xl mx-auto flex gap-3 items-end">
                    <textarea id="user-input" rows="1" 
                        placeholder="E.g. Build a professional Earning App with Wallet and Daily Tasks..." 
                        class="flex-1 bg-zinc-900 border border-zinc-800 rounded-2xl px-5 py-4 focus:outline-none focus:ring-2 focus:ring-blue-500/50 text-white shadow-inner transition-all min-h-[56px]"></textarea>
                    
                    <button id="send-btn" onclick="generateWeb()" 
                        class="bg-blue-600 hover:bg-blue-500 text-white p-4 rounded-2xl transition-all shadow-lg shadow-blue-600/20 active:scale-95 disabled:opacity-50">
                        <div id="btn-content">
                            <svg xmlns="[http://www.w3.org/2000/svg](http://www.w3.org/2000/svg)" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" d="M14 5l7 7m0 0l-7 7m7-7H3" />
                            </svg>
                        </div>
                        <div id="btn-loading" class="hidden"><div class="loading-spinner"></div></div>
                    </button>
                </div>
            </footer>
        </main>
    </div>

    <div id="settings-modal" class="fixed inset-0 bg-black/90 backdrop-blur-sm flex items-center justify-center z-50 hidden p-4">
        <div class="bg-zinc-900 border border-zinc-800 p-8 rounded-3xl w-full max-w-md shadow-2xl">
            <h2 class="text-2xl font-bold mb-6 flex items-center gap-2">‚öôÔ∏è API Config</h2>
            <div class="space-y-5">
                <div>
                    <label class="block text-xs font-black text-zinc-500 uppercase tracking-widest mb-2">Endpoint URL</label>
                    <input id="api-url" type="text" class="w-full bg-zinc-950 border border-zinc-800 rounded-xl p-3 text-sm focus:border-blue-500 outline-none" value="[https://openrouter.ai/api/v1/chat/completions](https://openrouter.ai/api/v1/chat/completions)">
                </div>
                <div>
                    <label class="block text-xs font-black text-zinc-500 uppercase tracking-widest mb-2">OpenRouter API Key</label>
                    <input id="api-key" type="password" class="w-full bg-zinc-950 border border-zinc-800 rounded-xl p-3 text-sm focus:border-blue-500 outline-none" placeholder="sk-or-v1-...">
                </div>
                <div>
                    <label class="block text-xs font-black text-zinc-500 uppercase tracking-widest mb-2">Model ID</label>
                    <input id="model-id" type="text" class="w-full bg-zinc-950 border border-zinc-800 rounded-xl p-3 text-sm focus:border-blue-500 outline-none" value="deepseek/deepseek-chat">
                </div>
                <div class="flex gap-3 mt-4">
                    <button onclick="saveSettings()" class="flex-1 bg-blue-600 py-3 rounded-xl font-bold hover:bg-blue-500 transition active:scale-95">Apply Settings</button>
                    <button onclick="toggleSettings(false)" class="flex-1 bg-zinc-800 py-3 rounded-xl font-bold hover:bg-zinc-700 transition">Close</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // System Config
        const SYSTEM_PROMPT = `You are an expert mobile app and web developer. 
        Output ONLY the complete, single-file HTML code. 
        Include all CSS (Tailwind) and JS logic within the file. 
        Use modern UI components, animations, and high-quality icons (Lucide or FontAwesome).
        If asked for an Earning App, include Dashboard, Task List, Wallet, and Profile sections.
        DO NOT explain anything. DO NOT use markdown code blocks. Start directly with <!DOCTYPE html>.`;

        let projects = JSON.parse(localStorage.getItem('projects') || '[]');
        let currentCode = "";

        window.onload = () => {
            // Load saved settings or defaults
            document.getElementById('api-url').value = localStorage.getItem('apiUrl') || "[https://openrouter.ai/api/v1/chat/completions](https://openrouter.ai/api/v1/chat/completions)";
            document.getElementById('api-key').value = localStorage.getItem('apiKey') || "";
            document.getElementById('model-id').value = localStorage.getItem('modelId') || "deepseek/deepseek-chat";
            renderProjects();
        };

        function toggleSettings(show) { document.getElementById('settings-modal').classList.toggle('hidden', !show); }

        function saveSettings() {
            localStorage.setItem('apiUrl', document.getElementById('api-url').value);
            localStorage.setItem('apiKey', document.getElementById('api-key').value);
            localStorage.setItem('modelId', document.getElementById('model-id').value);
            toggleSettings(false);
            alert("Settings Saved!");
        }

        async function generateWeb() {
            const prompt = document.getElementById('user-input').value;
            const apiKey = localStorage.getItem('apiKey');
            const apiUrl = localStorage.getItem('apiUrl');
            const modelId = localStorage.getItem('modelId');

            if (!apiKey) { alert("First, add your API Key in Settings!"); return toggleSettings(true); }
            if (!prompt) return;

            // UI State Loading
            const sendBtn = document.getElementById('send-btn');
            const btnContent = document.getElementById('btn-content');
            const btnLoading = document.getElementById('btn-loading');
            
            sendBtn.disabled = true;
            btnContent.classList.add('hidden');
            btnLoading.classList.remove('hidden');

            try {
                const response = await fetch(apiUrl, {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${apiKey}`,
                        'Content-Type': 'application/json',
                        'HTTP-Referer': window.location.origin,
                        'X-Title': 'AI App Builder'
                    },
                    body: JSON.stringify({
                        model: modelId,
                        messages: [
                            { role: "system", content: SYSTEM_PROMPT },
                            { role: "user", content: prompt }
                        ],
                        temperature: 0.7
                    })
                });

                const text = await response.text();
                if (!response.ok) throw new Error("API Error: " + text);

                const data = JSON.parse(text);
                let aiResponse = data.choices[0].message.content;

                // CRITICAL: Clean AI junk like ```html or intro text
                currentCode = aiResponse.replace(/```html|```|<!DOCTYPE html>/gi, '').trim();
                currentCode = "<!DOCTYPE html>\n" + currentCode; // Ensure valid start

                updateUI(currentCode);
                saveProject(prompt, currentCode);

            } catch (err) {
                console.error(err);
                alert("Generation Failed: " + err.message);
            } finally {
                sendBtn.disabled = false;
                btnContent.classList.remove('hidden');
                btnLoading.classList.add('hidden');
                document.getElementById('user-input').value = "";
            }
        }

        function updateUI(code) {
            const iframe = document.getElementById('preview-frame');
            iframe.srcdoc = code;
            document.getElementById('code-display').textContent = code;
        }

        function setView(view) {
            const isPreview = view === 'preview';
            document.getElementById('preview-frame').classList.toggle('hidden', !isPreview);
            document.getElementById('code-view').classList.toggle('hidden', isPreview);
            
            document.getElementById('btn-preview').classList.toggle('bg-blue-600', isPreview);
            document.getElementById('btn-preview').classList.toggle('text-white', isPreview);
            document.getElementById('btn-code').classList.toggle('bg-blue-600', !isPreview);
            document.getElementById('btn-code').classList.toggle('text-white', !isPreview);
        }

        function saveProject(prompt, code) {
            const project = { id: Date.now(), title: prompt.substring(0, 35), code: code };
            projects.unshift(project);
            localStorage.setItem('projects', JSON.stringify(projects.slice(0, 20))); // Save last 20
            renderProjects();
        }

        function renderProjects() {
            const container = document.getElementById('project-list');
            container.innerHTML = projects.map(p => `
                <button onclick="loadProject(${p.id})" class="w-full text-left p-3 rounded-xl hover:bg-zinc-900 transition text-sm text-zinc-400 truncate flex items-center gap-2">
                    <span>üìÅ</span> ${p.title}
                </button>
            `).join('');
        }

        function loadProject(id) {
            const p = projects.find(proj => proj.id === id);
            if (p) { currentCode = p.code; updateUI(currentCode); }
        }

        function newProject() {
            currentCode = "";
            updateUI("");
            document.getElementById('user-input').value = "";
            setView('preview');
        }

        function downloadCode() {
            if (!currentCode) return alert("Nothing to export!");
            const blob = new Blob([currentCode], { type: 'text/html' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'ai-app-build.html';
            a.click();
        }
    </script>
</body>
</html>
